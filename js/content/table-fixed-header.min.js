"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var l=t[i];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(e,l.key,l)}}function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),e}window.ST=window.ST||{},function(e){var t,i,l=(t=e.makeOffsetFunction(),function(){return t()+e.getWpAdminBarHeight()});e.addInit(4,function(){var t=document.querySelectorAll(".stile table:not([class])");setTimeout(function(){!function(t){i=parseInt(n());for(var l=[],s=0;s<t.length;s+=1)l.push(new a(t[s]));e.onScroll(function(){for(var e=0,t=l;e<t.length;e++){var i=t[e];i.onWindowScroll()}}),e.onResize(function(){for(var e=0,t=l;e<t.length;e++){var i=t[e];i.onWindowResize()}})}(t)},0)});var a=function(){function t(e){var i=this;_classCallCheck(this,t),e.style.height&&(e.style.height=""),this._table=e,this._headerHeight=0,this._isEnlarged=!1,this._windowWidth=Math.min(window.outerWidth,window.innerWidth),this._create(),setTimeout(function(){i._initialize()},10)}return _createClass(t,[{key:"_create",value:function(){this._head=this._createHeaderClone(),this._sbar=this._createScrollBarClone(),this._ebtn=e.containStile(this._table,"no-enlarger")?null:this._createEnlargerButton(),this._shade=this._createShade();var t=this._table.getElementsByTagName("caption");this._capt=t.length?t[0]:null,("ie11"===e.BROWSER||"edge"===e.BROWSER)&&this._head&&this._capt&&this._table.insertBefore(this._capt,this._table.firstChild)}},{key:"_createHeaderClone",value:function(){var t=this._table.tHead;if(!t){if(!(t=this._createPseudoHeader()))return null;this._table.tHead=t}var i=document.createElement("div");e.addStile(i,"fixed-table-header-container"),this._table.parentNode.appendChild(i);var l=document.createElement("div");e.addStile(l,"fixed-table-header-table"),i.appendChild(l);var a=t.cloneNode(!0);return l.appendChild(a),e.containStile(this._table,"table-enlarged")&&e.addStile(i,"table-enlarged"),i}},{key:"_createPseudoHeader",value:function(){var e=this._table.tBodies[0].rows;if(0===e.length)return null;function t(e){var t=e.getElementsByTagName("td"),i=e.getElementsByTagName("th");return 0===t.length&&i.length>0}for(var i=[],l=0,a=e.length;l<a;l+=1){var n=e[l];if(!t(n))break;i.push(n)}if(0===i.length)return null;for(var s=this._table.createTHead(),r=0;r<i.length;r+=1)s.appendChild(i[r]);return s}},{key:"_createScrollBarClone",value:function(){var t=document.createElement("div");e.addStile(t,"fixed-table-scroll-bar"),this._table.parentNode.appendChild(t);var i=document.createElement("div");return t.appendChild(i),t}},{key:"_createEnlargerButton",value:function(){var e=document.createElement("div");return e.dataset.stile="enlarger-button",this._table.appendChild(e),e}},{key:"_createShade",value:function(){var e=document.createElement("div");return e.dataset.stile="table-shade",this._table.appendChild(e),e}},{key:"_initialize",value:function(){var e=this;this._initTableScroll(),this._ebtn&&(this._ebtn.addEventListener("click",function(){e._isEnlarged?e._turnOffEnlarged():e._turnOnEnlarged()}),this._isEnlargable()||(this._ebtn.style.display="none")),this._resize()}},{key:"_initTableScroll",value:function(){var t=this,i=!1,l=!1;this._table.addEventListener("scroll",e.throttle(function(){i?i=!1:(t._sbar.scrollLeft=t._table.scrollLeft,l=!0),t._onTableScroll()})),this._sbar.addEventListener("scroll",e.throttle(function(){l?l=!1:(t._table.scrollLeft=t._sbar.scrollLeft,i=!0)}))}},{key:"_isScrollable",value:function(){var e=this._table;return e.scrollWidth-e.clientWidth>2}},{key:"_isEnlargable",value:function(){var e=this._table,t=Math.min(window.outerWidth,window.innerWidth);return e.scrollWidth-e.offsetWidth>1&&e.offsetWidth<.9*t}},{key:"_turnOnEnlarged",value:function(){var t=this._table;if(!(t.scrollWidth-t.offsetWidth<=1)){t.scrollLeft=0,t.style.width="calc(100vw - "+i+"px)",e.addStile(t,"table-enlarged"),e.addStile(this._head,"table-enlarged"),this._isEnlarged=!0;var l=t.getBoundingClientRect().left+window.pageXOffset,a=t.tBodies[0].clientWidth,n=this._windowWidth-i;a<n&&(l-=(n-a)/2),t.style.marginLeft=-l+"px",t.style.background=null,this._resize()}}},{key:"_turnOffEnlarged",value:function(){var t=this._table;t.style.marginLeft="",t.style.width="",t.scrollLeft=0,e.removeStile(t,"table-enlarged"),e.removeStile(this._head,"table-enlarged"),this._isEnlarged=!1,e.removeStile(this._shade,"visible"),this._shade.style.background=null,this._resize()}},{key:"onWindowResize",value:function(){var e=Math.min(window.outerWidth,window.innerWidth);this._windowWidth!==e&&(this._windowWidth=e,this._isEnlarged?this._turnOffEnlarged():this._resize())}},{key:"_resize",value:function(){this._head&&this._updateHeaderSize(this._head),this._sbar&&this._updateScrollBarSize(this._sbar),(this._head||this._sbar)&&this.onWindowScroll(),this._onTableScroll()}},{key:"_updateHeaderSize",value:function(t){t.style.maxWidth=this._table.getBoundingClientRect().width+"px",t.style.display="none",t.style.top=l()+"px";var i=this._table.tHead,a=i.getBoundingClientRect().width;"ie11"===e.BROWSER&&(a=Math.ceil(a));var n=t.firstChild;n.style.width=a+"px";for(var s=n.firstChild,r=i.rows,h=s.rows,o=0;o<r.length;o+=1)d(r[o],h[o],"td"),d(r[o],h[o],"th");function d(e,t,i){for(var l=e.getElementsByTagName(i),a=t.getElementsByTagName(i),n=0;n<l.length;n+=1)a[n].style.width=l[n].getBoundingClientRect().width+"px"}this._headerHeight=i.getBoundingClientRect().height}},{key:"_updateScrollBarSize",value:function(e){e.style.maxWidth=this._table.clientWidth+"px",e.style.display="none";var t=parseInt(n());0<t&&(e.style.height=t+2+"px");var i=this._table.tBodies[0];e.firstChild.style.width=Math.ceil(i.clientWidth)+"px"}},{key:"onWindowScroll",value:function(){var e=this._table.getBoundingClientRect(),t=e.top,i=e.bottom,a=l(),n=this._capt?this._capt.offsetHeight:0,s=this._headerHeight,r=i-t-n<.9*(window.innerHeight-a),h=!1;r||a<t+n||i-s<a||t+n<a&&(h=!0);var o=!1;r||window.innerHeight<t+n+s||i<window.innerHeight||this._isScrollable()&&(o=!0),this._head&&this.updateHeaderVisibility(h,e.left),this._sbar&&this.updateScrollBarVisibility(o,e.left)}},{key:"updateHeaderVisibility",value:function(t,i){var a=this._head;t?(a.style.top=l()+e.getWpAdminBarHeight()+"px",a.style.display="block",this._ebtn&&this.switchEnlargerToFloatingHeader()):(a.style.display="none",this._ebtn&&this.switchEnlargerToTable()),a.style.left=i+"px",a.scrollLeft=this._table.scrollLeft}},{key:"switchEnlargerToTable",value:function(){this._ebtn.parentNode.removeChild(this._ebtn),this._ebtn.style.top=this._capt?this._capt.offsetHeight+"px":0,this._table.appendChild(this._ebtn)}},{key:"switchEnlargerToFloatingHeader",value:function(){this._ebtn.parentNode.removeChild(this._ebtn),this._ebtn.style.top=0,this._head.appendChild(this._ebtn)}},{key:"updateScrollBarVisibility",value:function(e,t){var i=this._sbar;i.style.display=e?"block":"none",i.style.left=t+"px",i.scrollLeft=this._table.scrollLeft}},{key:"_onTableScroll",value:function(){var t=this._table,i=this._head,l=this._capt,a=this._ebtn,n=this._shade,s=Math.max(0,Math.min(t.scrollLeft,t.scrollWidth-t.offsetWidth));i&&(i.scrollLeft=s),l&&(this._isScrollable()?(this._stCapt&&clearTimeout(this._stCapt),this._stCapt=setTimeout(function(){l.style.transform="translateX(".concat(s,"px)")},20)):l.style.transform=null),a&&(e.removeStile(a,"visible"),this._stEbtn&&clearTimeout(this._stEbtn),this._stEbtn=setTimeout(function(){e.addStile(a,"visible")},100),this._updateEnlager()),this._isEnlarged&&(e.removeStile(n,"visible"),this._isScrollable()&&this._isEnlarged&&(this._stShade&&clearTimeout(this._stShade),this._stShade=setTimeout(function(){n.style.transform="translateX(".concat(s,"px)"),e.addStile(n,"visible")},100))),this._updateShade()}},{key:"_updateEnlager",value:function(){var e=this._table,t=this._capt,i=this._ebtn,l=e.scrollLeft,a=this._table.tBodies[0].clientWidth,n=e.clientWidth;if(this._isEnlargable()||this._isEnlarged){var s=-Math.min(a-n,l);if(!this._isEnlargable()&&this._isEnlarged){var r=i.parentElement.clientWidth-a;0<r&&(s=r)}i.parentNode===e&&(i.style.top=t?t.offsetHeight+"px":0),i.style.right=s+"px",i.style.display="block"}else i.style.display="none"}},{key:"_updateShade",value:function(){var e=this._table,t=this._shade;if(this._isScrollable()){var i=this._calcShadeStyle();this._isEnlarged?t.style.background=i:e.style.background=i}else e.style.background=null}},{key:"_calcShadeStyle",value:function(){var e=this._table,t=e.scrollLeft/(e.scrollWidth-e.clientWidth),i=.25,l=.25;t<.1&&(i*=t/.1),.9<t&&(l*=(1-t)/.1);var a=this._capt?this._capt.offsetHeight+"px":"0";return"linear-gradient(to left, rgba(0,0,0,0), rgba(0,0,0,".concat(i,") 1.25rem) 0 ").concat(a," / 1.25rem 100% no-repeat scroll")+","+"linear-gradient(to right, rgba(0,0,0,0), rgba(0,0,0,".concat(l,") 1.25rem) right ").concat(a," / 1.25rem 100% no-repeat scroll")}}]),t}();function n(){var e=document.createElement("div");e.style.bottom="100%",e.style.height="1px",e.style.position="absolute",e.style.width="calc(100vw - 100%)",document.body.appendChild(e);var t=0|window.getComputedStyle(e,"").getPropertyValue("width");if(0===t){e.style.overflowY="scroll",e.style.width="";var i=document.createElement("div");i.style.minHeight="100px",e.appendChild(i);var l=0|window.getComputedStyle(i,"").getPropertyValue("width");t=e.offsetWidth-l}return document.body.removeChild(e),t}}(window.ST);