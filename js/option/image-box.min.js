"use strict";function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function _iterableToArrayLimit(e,t){var i=[],n=!0,s=!1,r=void 0;try{for(var a,o=e[Symbol.iterator]();!(n=(a=o.next()).done)&&(i.push(a.value),!t||i.length!==t);n=!0);}catch(e){s=!0,r=e}finally{try{n||null==o.return||o.return()}finally{if(s)throw r}}return i}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),e}window.ST=window.ST||{},function(e){var t="image-box",i="image-box-close",n="image-box-caption";function s(t,i){for(var n=function(t){for(var i=[],n=0;n<t.length;n+=1){var s=t[n];if(e.containStile(s,"link-image")){var a=s.href;if(a&&r(a)){var o=s.getElementsByTagName("img");if(0!==o.length){var l=o[0],c=l.dataset.src?l.dataset.src:l.src;c&&r(c)&&i.push(s)}}}}return i}(t),s=0;s<n.length;s+=1)i.push(new l(n[s]))}function r(e){var t=(e=(e=e.split("?")[0]).toLowerCase()).split(".");switch(t[t.length-1]){case"jpeg":case"jpg":case"png":case"gif":return!0}return!1}function a(e){var t=0,i=0;return 1===e.length?(t=e[0].pageX-window.pageXOffset,i=e[0].pageY-window.pageYOffset):2<=e.length&&(t=(e[0].pageX+e[1].pageX)/2-window.pageXOffset,i=(e[0].pageY+e[1].pageY)/2-window.pageYOffset),[t,i]}function o(e){return[e.pageX-window.pageXOffset,e.pageY-window.pageYOffset]}e.addInit(2,function(){var t=[];s(document.querySelectorAll(".stile a"),t),s(document.querySelectorAll(".stile-image-box a"),t),e.onResize(function(){for(var e=0,i=t;e<i.length;e++){i[e].setInitialSize()}setTimeout(function(){for(var e=0,i=t;e<i.length;e++){i[e].setInitialSize()}},200)})});var l=function(){function s(r){var a=this;_classCallCheck(this,s),this._src=r.href,r.addEventListener("click",function(e){a.onOpen(e)}),this._frm=document.createElement("div"),e.addStile(this._frm,t),this._frm.addEventListener("click",function(e){a.onClose(e)}),this._img=document.createElement("img"),this._img.addEventListener("click",function(e){e.stopPropagation()}),this._frm.appendChild(this._img);var o=document.createElement("span");if(e.addStile(o,i),this._frm.appendChild(o),"FIGURE"===r.parentNode.tagName){var l=r.parentNode.getElementsByTagName("figcaption");if(0<l.length){var c=document.createElement("div");c.innerHTML=l[0].innerHTML,e.addStile(c,n),this._frm.appendChild(c)}}document.body.appendChild(this._frm),this.enableMouseGesture(),this.enableTouchGesture()}return _createClass(s,[{key:"onOpen",value:function(t){var i=this;t.preventDefault(),e.addStile(this._frm,"open"),this._img.src||(this._img.style.opacity="0",this._img.src=this._src,this._img.addEventListener("load",function(){i.setInitialSize(),i._img.style.opacity="1"}));var n="ie11"===e.BROWSER?30:0;setTimeout(function(){i.setInitialSize(),e.addStile(i._frm,"visible")},n)}},{key:"onClose",value:function(t){var i=this;t.preventDefault(),e.removeStile(this._frm,"visible"),setTimeout(function(){e.removeStile(i._frm,"open")},200)}},{key:"setInitialSize",value:function(){this._isPhone=-1!==e.MEDIA_WIDTH.indexOf("phone"),this._scale=1;var t=this._frm.offsetWidth/this._frm.offsetHeight,i=this._img.offsetWidth/this._img.offsetHeight;this._isLandscape=t<i;var n=this._isPhone?"100%":"calc(100% - 4rem)";this._isLandscape?(this._img.style.minWidth="",this._img.style.minHeight="",this._img.style.width=n,this._img.style.height="auto"):(this._img.style.minWidth="",this._img.style.minHeight="",this._img.style.width="auto",this._img.style.height=n,this._img.style.maxWidth="none"),this._baseSize=this._isLandscape?this._frm.clientWidth:this._frm.clientHeight,this.doCenteringImage()}},{key:"setScaledSize",value:function(e){this._scale=Math.max(1,Math.min(5,e));var t=this._baseSize*this._scale+"px";this._isPhone||(t="calc(".concat(t," - ").concat("4rem",")")),this._isLandscape?this._img.style.minWidth=t:this._img.style.minHeight=t,this.doCenteringImage()}},{key:"doCenteringImage",value:function(){var e=this._img.offsetWidth,t=this._img.offsetHeight,i=this._frm.clientWidth,n=this._frm.clientHeight;this._img.style.left=e<i?(i-e)/2+"px":0,this._img.style.top=t<n?(n-t)/2+"px":0}},{key:"enableMouseGesture",value:function(){var e=this,t=0,i=0,n=!1;this._frm.addEventListener("mousedown",function(e){e.preventDefault();var s=_slicedToArray(o(e),2);t=s[0],i=s[1],n=!0}),this._frm.addEventListener("mousemove",function(s){if(n){s.stopPropagation(),s.preventDefault();var r=_slicedToArray(o(s),2),a=r[0],l=r[1];e._frm.scrollLeft+=t-a,e._frm.scrollTop+=i-l,t=a,i=l}}),this._frm.addEventListener("mousedrag",function(e){n&&(e.stopPropagation(),e.preventDefault())}),this._frm.addEventListener("mouseup",function(){n=!1}),this._frm.addEventListener("wheel",function(t){t.stopPropagation(),t.preventDefault();var i=_slicedToArray(o(t),2),n=i[0],s=i[1],r=(n+e._frm.scrollLeft)/e._scale,a=(s+e._frm.scrollTop)/e._scale,l=0>t.deltaY?1.1:.9;e.setScaledSize(e._scale*l),e._frm.scrollLeft=r*e._scale-n,e._frm.scrollTop=a*e._scale-s},!0)}},{key:"enableTouchGesture",value:function(){var e,t,i=this,n=0,s=0,r=0,o=0;function l(e){r=e.length;var t=_slicedToArray(a(e),2);n=t[0],s=t[1]}e=this._frm,t=!1,window.addEventListener("touchmove",function(e){t&&(e.preventDefault(),e.stopImmediatePropagation())},{passive:!1}),e.addEventListener("touchstart",function(){t=!0}),e.addEventListener("touchend",function(){t=!1}),this._frm.addEventListener("touchstart",function(e){o=0,l(e.touches)}),this._frm.addEventListener("touchmove",function(e){e.preventDefault(),e.stopPropagation();var t=e.touches;r!==t.length&&l(t);var c=_slicedToArray(a(t),2),f=c[0],h=c[1];if(i._frm.scrollLeft+=n-f,i._frm.scrollTop+=s-h,n=f,s=h,2<=t.length){var m=(f+i._frm.scrollLeft)/i._scale,u=(h+i._frm.scrollTop)/i._scale,d=function(e){var t=e[0].screenX,i=e[0].screenY,n=e[1].screenX,s=e[1].screenY;return Math.sqrt(Math.pow(n-t,2)+Math.pow(s-i,2))}(t);if(o){var _=d/(o*i._scale);_&&_!==1/0&&(i.setScaledSize(i._scale*_),i._frm.scrollLeft=m*i._scale-f,i._frm.scrollTop=u*i._scale-h)}o=d/i._scale}},{passive:!1})}}]),s}()}(window.ST);